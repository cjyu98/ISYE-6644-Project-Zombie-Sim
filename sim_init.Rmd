---
title: "ISYE 6644 - Project"
output: html_notebook
---
Code intended for mostly exploring Epimodel as a package/capabilities

# Original Example
Initial code pulled from: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5931789/
from Example 1

```{r init, warning=FALSE, message=FALSE}
# clear environment
rm(list=ls())

# libraries
library(EpiModel)
```


```{r}
set.seed(12345)
#SIS sample model

nw <- network::network.initialize(n = 1000, directed = FALSE) # n is number of nodes
nw <- network::set.vertex.attribute(nw, "risk", rep(0:1, each = 500))
formation <- ~edges + nodefactor("risk") + nodematch("risk") + concurrent
target.stats <- c(250, 375, 225, 100)
coef.diss <- dissolution_coefs(dissolution = ~ offset(edges), duration = 80)
coef.diss

```
```{r}
est1 <- netest(nw, formation, target.stats, coef.diss)
dx <- netdx(est1, nsims = 10, nsteps = 1000)
dx
```

```{r}
init <- init.net(i.num = 50)
param <- param.net(inf.prob = 0.1, act.rate = 5, rec.rate = 0.02)
control <- control.net(type = "SIS", nsteps = 500, nsims = 10, epi.by = "risk")
sim1 <- netsim(est1, param, init, control)
```

```{r}
summary(sim1, 500)
```
Code pulled from: https://epimodel.github.io/epimodel-training/basics_of_network_models/sis_basics.html and https://epimodel.github.io/epimodel-training/network_models_with_feedback/vaccine_intervention.html

# Main SIR model

Adjusted for an SIR model, added in inter.eff & inter.start for intervention

```{r}
start <- Sys.time()
# temporal ergm set up
n = 500
nw <- network_initialize(n = n) #n is number of nodes in the network
nw <- set_vertex_attribute(nw, attrname = "risk", value = rep(0:1, each = 250)) # add risk attribute (essentially mark 2 groups)

formation <- ~edges + nodefactor("risk") + nodematch("risk") #set up edges and risk factor for nodes
overall_mean_deg = 0.5
gr1_mean_deg = 0.75
perc_in_grp = 0.9

target.stats <- c(overall_mean_deg*n/2, gr1_mean_deg*n/2, perc_in_grp*n/4) #goal of edges, need to decide on mean degree
coef.diss <- dissolution_coefs(dissolution = ~offset(edges), duration = 20, d.rate = 0.001) # need to work on this
est <- netest(nw, formation, target.stats, coef.diss) #estimate coefficients of the network


param <- param.net(inf.prob = 0.5, inter.eff = rnorm(1), inter.start = 500, rec.rate = 0.02) #di.rate = 0.001, ds.rate = 0.001, dr.rate = 0.001, a.rate = 0.001 for average mortality
# https://statnet.org/nme/d4-s3-Demography.html

#infection probability, efficacy of intervention, when does it intervene

init <- init.net(i.num = 5, r.num = 10) #how many people are infected/recovered at the start
control <- control.net(type = "SIR", nsteps = 1000, nsims = 10, ncores = 5) #simulation parameters
sim <- netsim(est, param, init, control) #run the sim
plot(sim)
end <- Sys.time()
end - start
```



